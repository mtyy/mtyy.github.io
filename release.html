<!DOCTYPE html>
<html>
<title>ReleaseBoot</title>
<style>
    body {
        margin: 2%;
        margin-top: 0;
        background-color: #222222;
        color: white;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        font-weight: 500;
        font-size: larger;
        line-height: 1.8;
    }

    input {
        color: white;
        background-color: black;
        width: 10%;
        margin-bottom: 12px;
        margin-top: 4px;
        margin-right: 8px;
        font-size: larger;
    }

    h1 {
        text-align: center;
    }

    a {
        color: rgb(215, 215, 215);
    }

    #results {
        word-spacing: 10px;
    }
</style>


<body onload="initialize()">
    <h1>ReleaseBoot</h1>
    <p>
    <div>
        <div>
            Youll release mail:
            <input id="mail" onkeyup="generateLinks()">
            With cloud:
            <input id="cloud" onkeyup="generateLinks()">
            With libs:
            <input id="libs" onkeyup="generateLinks()">
        </div>
    </div>
    </p>
    <p id="results"></p>

</body>

<script>

    function getP() {
        return document.getElementById("results")
    }

    function generateLinks() {
        // clear this bad boy
        getP().innerHTML = ""

        const mail = document.getElementById("mail").value;
        const cloud = document.getElementById("cloud").value;
        const libs = document.getElementById("libs").value;

        const mailMajor = parseInt(mail.split('.')[0])
        const mailMinor = parseInt(mail.split('.')[1])
        const currentMail = `${mailMajor}.${mailMinor}`
        const previousMail = `${mailMajor}.${mailMinor - 1}`

        const cloudMajor = parseInt(cloud.split('.')[0])
        const cloudMinor = parseInt(cloud.split('.')[1])
        const currentCloud = `${cloudMajor}.${cloudMinor}`
        const previousCloud = `${cloudMajor}.${cloudMinor - 1}`

        const libsMajor = parseInt(libs.split('.')[0])
        const libsMinor = parseInt(libs.split('.')[1])
        const currentLibs = `${libsMajor}.${libsMinor}`
        const previousLibs = `${libsMajor}.${libsMinor - 1}`



        buildRepo("Mail", "https://git.mam.dev/android/k9ui/", "development", `release/release_${currentMail}`, `release/release_${previousMail}`)
        buildRepo("Cloud", "https://git.mam.dev/android/andonlinestorage/", "development", `release/release_${currentCloud}`, `release/release_${previousCloud}`)
        buildRepo("Libs", "https://git.mam.dev/android/libs/", "development", `release/release_${currentLibs}`, `release/release_${previousLibs}`)


        addText("Diffs:")
        br()
        addLink(`https://git.mam.dev/android/k9ui/-/compare/release%2Frelease_${previousMail}...release%2Frelease_${currentMail}?from_project_id=303&straight=false`)
        addLink(`https://git.mam.dev/android/andonlinestorage/-/compare/release%2Frelease_${previousCloud}...release%2Frelease_${currentCloud}?from_project_id=292&straight=false`)
        addLink(`https://git.mam.dev/android/libs/-/compare/release%2Frelease_${previousLibs}...release%2Frelease_${currentLibs}?from_project_id=4146&straight=false`)



    }

    function addText(text) {
        getP().appendChild(document.createTextNode(`${text} `));
    }

    function buildRepo(name, baseurl, dev, release, previousRelease) {
        addText(name)
        br()
        addLink(`build.gradle`, `${baseurl}-/blob/${dev}/build.gradle`)
        addLink(`Commits`, `${baseurl}-/commits/${dev}`)
        addLink(`Graph`, `${baseurl}-/network/${dev}`)
        addText(dev)


        br()
        addLink(`build.gradle`, `${baseurl}-/blob/${previousRelease}/build.gradle`)
        addLink(`Commits`, `${baseurl}-/commits/${previousRelease}`)
        addLink(`Graph`, `${baseurl}-/network/${previousRelease}`)
        addText(previousRelease)

        br()

        addLink(`build.gradle`, `${baseurl}-/blob/${release}/build.gradle`)
        addLink(`Commits`, `${baseurl}-/commits/${release}`)
        addLink(`Graph`, `${baseurl}-/network/${release}`)
        addText(release)
        br()
        addLink('Pipelines', `${baseurl}-/pipelines`)

        br()
        br()

    }


    function addLink(name, address) {
        // Create anchor element.
        var a = document.createElement('a');
        // Create the text node for anchor element.
        var link = document.createTextNode(name);

        // Append the text node to anchor element.
        a.appendChild(link);
        // Set the title.
        a.title = address;
        // Set the href property.
        a.href = address;
        // open in new window plz
        a.target = "_blank"

        // Append the anchor element to the body.
        getP().appendChild(a);
        addText("")
    }

    function br() {
        // break the fucking line
        getP().appendChild(document.createElement("br"))
    }

    function initialize() {

        const urlSearchParams = new URLSearchParams(window.location.search);
        const params = Object.fromEntries(urlSearchParams.entries());

        setField("mail", params.mail)
        setField("cloud", params.cloud)
        setField("libs", params.libs)

        generateLinks()
    }

    function setField(id, value) {
        if (value != undefined) {
            document.getElementById(id).value = value
        }
    }

</script>

</html>
